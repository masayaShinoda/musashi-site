{% load static %} 
{% for product in products %}
<li>
  <a href="{% url 'product' product.slug %}"  class="flex flex-col border border-gray-200 rounded-sm group">
    <div class="w-full max-w-full max-h-full overflow-clip">
    <!-- TODO IMG THUMBNAIL -->
      {% if product.images.all.0.image %}
        <img src="{% get_media_prefix %}{{ product.images.all.0.image }}" alt="product.images.all.0.alt" width="400" height="400" loading="lazy" class="aspect-square object-cover object-center min-h-full max-h-full bg-gray-300 group-hover:scale-105 transition">
      {% else %}
        <div class="aspect-square min-h-full max-h-full w-full flex bg-gray-300"></div>
      {% endif %}
    </div>
    <div class="p-4">
      <h3 class="text-lg sm:text-xl font-semibold text-gray-800 mb-2 group-hover:text-brand">{{ product.name }}</h3>
      {% if product.variants.all %}
        <p class="text-xs sm:text-sm text-gray-600 tracking-wide">
        Volumes: &nbsp;{% for variant in product.variants.all %}<span class="text-gray-800">{% if forloop.counter > 1 %},&nbsp{% endif %}{{ variant.volume }}</span>{% endfor %}
        </p>
      {% endif %}
    </div>
  </a>
</li>
{% endfor %}


{# Only render this OOB swap block if it IS an HTMX request #}
{% if is_htmx_request %}
<div id="load-more-container" hx-swap-oob="true" class="w-full">
  {% if page_obj.has_next %}
  <nav class="w-full flex justify-center items-center py-6">
    <button 
      hx-get="?page={{ page_obj.next_page_number }}" 
      hx-target="#products_list"
      hx-swap="beforeend"
      hx-indicator="#loading-spinner-{{ page_obj.next_page_number }}"
      class="cursor-pointer inline-flex items-center justify-center text-base leading-6 text-gray-800 py-3 px-6 rounded-full border border-brand"
    >
      See More
    </button>
    <div id="loading-spinner-{{ page_obj.next_page_number }}" class="htmx-indicator">{% include 'layout/_spinner_speedometer.html' %}</div>
  </nav>
  {% else %}
  {% endif %}
</div>
{% endif %}
